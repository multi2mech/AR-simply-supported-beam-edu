<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Web AR 3D Model Viewer</title>
    
    <!-- Load three.js and necessary libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/loaders/GLTFLoader.js"></script>
    
    <!-- Load model-viewer for AR -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
        #ar-container { text-align: center; margin-top: 10px; }
        model-viewer { width: 100%; height: 600px; }
    </style>
</head>
<body>

    <!-- AR Viewer for Mobile -->
    <div id="ar-container">
        <model-viewer src="beam.glb" 
                      ar ar-modes="webxr scene-viewer quick-look"
                      auto-rotate 
                      camera-controls
                      animation-name="your_animation">
        </model-viewer>
    </div>

    <!-- Three.js WebGL Renderer for Desktop -->
    <script>
        let scene, camera, renderer, controls, mixer;

        function init() {
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xeeeeee);

            // Camera setup
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(3, 3, 6); // Adjust position to focus on model

            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Lighting
            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(5, 5, 5);
            scene.add(light);

            // Orbit Controls (for desktop users)
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            // Load glTF Model
            const loader = new THREE.GLTFLoader();
            loader.load('beam.glb', function (gltf) {
                let model = gltf.scene;
                scene.add(model);

                // Enable rendering of both front & back faces
                model.traverse((child) => {
                    if (child.isMesh) {
                        child.material.side = THREE.DoubleSide;
                    }
                });

                // Handle animations
                mixer = new THREE.AnimationMixer(model);
                gltf.animations.forEach((clip) => {
                    mixer.clipAction(clip).play();
                });

                animate();
            });

            // Handle window resizing
            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            if (mixer) mixer.update(0.016); // Keep animation running
            controls.update();
            renderer.render(scene, camera);
        }

        init();
    </script>

</body>
</html>